(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"1f1a":function(t,e,a){"use strict";var s=a("33c0"),n=a.n(s);n.a},"293a":function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"home"},[a("div",{staticClass:"home-body"},[a("div",{staticClass:"home-right"},[a("div",{staticClass:"chat"},[a("div",{ref:"chatScroll",staticClass:"chat-scroll",attrs:{id:"chatScroll"},on:{scroll:t.onScroll}},t._l(t.mensajes,(function(e){return a("div",{key:e.id,staticClass:"chat-container",class:{"chat-mensaje-propio":e.sender_id==t.userId},attrs:{id:e.id}},[a("div",{staticClass:"chat-mensaje"},[a("label",[t._v(t._s(e.message))])])])})),0),a("div",{staticClass:"chat-bottom"},[a("input",{ref:"inputTexto",attrs:{type:"text",placeholder:"Escribe un mensaje aqu√≠"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.enviar()}}}),a("button",{staticClass:"chat-enviar",on:{click:function(e){return t.enviar()}}},[t._v("Enviar")])])])])])])},n=[],i=(a("99af"),a("4160"),a("45fc"),a("159b"),{data:function(){return{mensajes:[],userId:null,primeraPagina:!0,currentPage:0,lastPage:0,mensajeOffset:null}},props:{},computed:{},mounted:function(){this.userId=localStorage.getItem("$userId"),this.getChat(),this.actualizar(),this.mensajes=[],this.$refs.chatScroll.addEventListener("touchmove",this.onScroll)},created:function(){var t=this;this.$eventHub.$on("chat-get",(function(e){return t.getChat(e)}))},methods:{actualizar:function(){var t=this;setTimeout((function(){t.getChat(),t.actualizar()}),3e3)},getChat:function(t){null==t?t=this.$route.params.id:(this.mensajes=[],this.primeraPagina=!0);var e=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+t).then((function(t){1!=e.primeraPagina||e.isOverflown(document.getElementById("chatScroll"))||(e.primeraPagina=!1,e.getChatPage(2));var a=!1;e.lastPage=t.data.messages.last_page,t.data.messages.data.reverse(),t.data.messages.data.forEach((function(t){e.mensajes.some((function(e){return e.id==t.id}))||t.conversation_id!=e.$route.params.id||(e.mensajes.push(t),a=!0)})),1==a&&(e.mensajeOffset=e.mensajes[e.mensajes.length-1],e.scrollToBottom())})).catch((function(){}))},getChatPage:function(t){this.mensajeOffset=this.mensajes[0],this.currentPage=t;var e="";null!=t&&(e="?page="+t);var a=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+this.$route.params.id+e).then((function(t){t.data.messages.data.reverse(),a.mensajes=t.data.messages.data.concat(a.mensajes),a.scrollToBottom()})).catch((function(){}))},onScroll:function(){var t=this.$refs.chatScroll;t.scrollTop<.1*t.clientHeight&&this.currentPage<this.lastPage&&(this.offset=this.offset+this.limit,this.currentPage++,this.getChatPage(this.currentPage))},scrollToBottom:function(){var t=this;this.$nextTick((function(){document.getElementById("chatScroll").scrollTop=document.getElementById(t.mensajeOffset.id).offsetTop}))},enviar:function(){this.scrollToBottom();var t=this.$refs.inputTexto.value;if(""!=t){this.$refs.inputTexto.value="";var e=new FormData;e.append("message",t),e.append("receiver_id",this.$route.params.user_dest_id);var a=this;this.$axios.post(this.$localurl+"/api/v1/messages",e).then((function(){a.getChat()})).catch((function(){alert("Se produjo un error, reintente")}))}},isOverflown:function(t){return t.scrollHeight>t.clientHeight||t.scrollWidth>t.clientWidth}}}),r=i,o=(a("1f1a"),a("79a0"),a("2877")),c=Object(o["a"])(r,s,n,!1,null,"4f905f41",null);e["default"]=c.exports},"33c0":function(t,e,a){},"79a0":function(t,e,a){"use strict";var s=a("7ffa"),n=a.n(s);n.a},"7ffa":function(t,e,a){}}]);
//# sourceMappingURL=chat.3efe7a3a.js.map