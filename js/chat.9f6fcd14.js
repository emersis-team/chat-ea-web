(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"03a8":function(e,s){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAqCAYAAAD1T9h6AAAABHNCSVQICAgIfAhkiAAAAVlJREFUWEfV2c1Nw0AQQOGXAhCUkBLoAOgESsiFHuggR1JBOHIDUQEUgEQJHDhyiCayI8da/86sd8b3jN+3q0ReZ4XtdQXsgQ3waTs6PW1leBOJfwOugV/gbgmEFaAZX6/JIggLQCpeEF/AbbUbhht9PkoLKBovFA2geLwG4CJ+LsBN/ByAq/ipAHfxUwAu48cC3MaPAbiOHwK4j+8DhIjvAoSJTwFCxbcB4eKbgJDxNaAr/q86Uf1ne5jXD97K4/Q7cKOfVWTCowDkDCuIyyIJupseAXJFRZwANeIDuGgtyhPwqluobJ/+bh8pu3biAXjOlqEYnDoTh0J0HerDIPreSoRADL1WcY8YAvT9xLr4Yo8BuEaMBbhFTAG4REwFuEPMAbhCzAW4QWgALhBaQHGEBaAPIX/0yWEp22UFSCF2wH228mqwJaCJeFkiXm5oDZCZa+An98rX8w+YCmb+NJKbQwAAAABJRU5ErkJggg=="},"293a":function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,a=e._self._c||s;return a("div",{staticClass:"home"},[a("div",{staticClass:"home-body"},[a("div",{staticClass:"home-right"},[a("div",{staticClass:"chat"},[a("div",{staticClass:"chat-top"},[a("img",{attrs:{src:t("03a8")},on:{click:function(s){return e.$router.back()}}}),a("p",{on:{click:function(s){return e.$router.back()}}},[e._v(e._s(null!=e.$conversacionElegida?e.$conversacionElegida.user_dest.name:""))])]),a("div",{ref:"chatScroll",staticClass:"chat-scroll",attrs:{id:"chatScroll"},on:{scroll:e.onScroll}},e._l(e.mensajes,(function(s){return a("div",{key:s.id,staticClass:"chat-container",class:{"chat-mensaje-propio":s.sender_id==e.userId},attrs:{id:s.id}},[a("MensajeTexto",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"TextMessage"==s.message_type.substr(11,100),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'TextMessage'"}],attrs:{mensaje:s.message}}),a("MensajeArchivo",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"FileMessage"==s.message_type.substr(11,100)&&e.esArchivo(s),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esArchivo(mensaje)"}],attrs:{mensaje:s.message}}),a("MensajeImagen",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"FileMessage"==s.message_type.substr(11,100)&&e.esImagen(s),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esImagen(mensaje)"}],attrs:{mensaje:s.message}}),a("MensajeVideo",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"FileMessage"==s.message_type.substr(11,100)&&e.esVideo(s),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esVideo(mensaje)"}],attrs:{mensaje:s.message}})],1)})),0),a("div",{staticClass:"chat-bottom"},[a("div",{staticClass:"chat-adjuntar",attrs:{title:"Adjuntar"},on:{click:function(s){return e.adjuntar()}}},[a("input",{ref:"adjuntoFiles",staticClass:"app-hide",attrs:{type:"file",multiple:""},on:{change:function(s){return e.changeAdjunto()}}}),a("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"}},[a("path",{attrs:{fill:"currentColor",d:"M1.816 15.556v.002c0 1.502.584 2.912 1.646 3.972s2.472 1.647 3.974 1.647a5.58 5.58 0 0 0 3.972-1.645l9.547-9.548c.769-.768 1.147-1.767 1.058-2.817-.079-.968-.548-1.927-1.319-2.698-1.594-1.592-4.068-1.711-5.517-.262l-7.916 7.915c-.881.881-.792 2.25.214 3.261.959.958 2.423 1.053 3.263.215l5.511-5.512c.28-.28.267-.722.053-.936l-.244-.244c-.191-.191-.567-.349-.957.04l-5.506 5.506c-.18.18-.635.127-.976-.214-.098-.097-.576-.613-.213-.973l7.915-7.917c.818-.817 2.267-.699 3.23.262.5.501.802 1.1.849 1.685.051.573-.156 1.111-.589 1.543l-9.547 9.549a3.97 3.97 0 0 1-2.829 1.171 3.975 3.975 0 0 1-2.83-1.173 3.973 3.973 0 0 1-1.172-2.828c0-1.071.415-2.076 1.172-2.83l7.209-7.211c.157-.157.264-.579.028-.814L11.5 4.36a.572.572 0 0 0-.834.018l-7.205 7.207a5.577 5.577 0 0 0-1.645 3.971z"}})])]),a("input",{ref:"inputTexto",attrs:{type:"text",placeholder:"Escribe un mensaje aqu√≠"},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.enviar()}}}),a("button",{staticClass:"chat-enviar",on:{click:function(s){return e.enviar()}}},[e._v("Enviar")])])])])])])},n=[],i=(t("99af"),t("4160"),t("45fc"),t("ac1f"),t("1276"),t("159b"),t("b620")),r=t("901b"),o=t("8a60"),c=t("b1af"),l={name:"Chat",components:{MensajeTexto:i["a"],MensajeArchivo:r["a"],MensajeImagen:o["a"],MensajeVideo:c["a"]},data:function(){return{mensajes:[],userId:null,primeraPagina:!0,currentPage:0,lastPage:0,mensajeOffset:null}},props:{},computed:{},mounted:function(){this.userId=localStorage.getItem("$userId"),this.getChat(),this.actualizar(),this.mensajes=[],this.$refs.chatScroll.addEventListener("touchmove",this.onScroll)},created:function(){var e=this;this.$eventHub.$on("chat-get",(function(s){return e.getChat(s)}))},methods:{actualizar:function(){var e=this;setTimeout((function(){e.getChat(),e.actualizar()}),3e3)},esImagen:function(e){var s=e.message.files[0].file.split(".")[1];return"png"==s||"jpg"==s||"svg"==s||"jpeg"==s},esVideo:function(e){var s=e.message.files[0].file.split(".")[1];return"webm"==s||"mkv"==s||"flv"==s||"mp4"==s||"mov"==s||"avi"==s},esArchivo:function(e){return 0==this.esImagen(e)&&0==this.esVideo(e)},getChat:function(e){null==e?e=this.$route.params.id:(this.mensajes=[],this.primeraPagina=!0);var s=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+e).then((function(e){1!=s.primeraPagina||s.isOverflown(document.getElementById("chatScroll"))||(s.primeraPagina=!1,s.getChatPage(2));var t=!1;s.lastPage=e.data.messages.last_page,e.data.messages.data.reverse(),e.data.messages.data.forEach((function(e){s.mensajes.some((function(s){return s.id==e.id}))||e.conversation_id!=s.$route.params.id||(s.mensajes.push(e),t=!0)})),1==t&&(s.mensajeOffset=s.mensajes[s.mensajes.length-1],s.scrollToBottom())})).catch((function(e){401==e.response.status&&(localStorage.removeItem("$expire"),s.$router.push("/login"))}))},getChatPage:function(e){this.mensajeOffset=this.mensajes[0],this.currentPage=e;var s="";null!=e&&(s="?page="+e);var t=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+this.$route.params.id+s).then((function(e){e.data.messages.data.reverse(),t.mensajes=e.data.messages.data.concat(t.mensajes),t.scrollToBottom()})).catch((function(e){401==e.response.status&&(localStorage.removeItem("$expire"),t.$router.push("/login"))}))},onScroll:function(){var e=this.$refs.chatScroll;e.scrollTop<.1*e.clientHeight&&this.currentPage<this.lastPage&&(this.offset=this.offset+this.limit,this.currentPage++,this.getChatPage(this.currentPage))},scrollToBottom:function(){var e=this;this.$nextTick((function(){null!=e.mensajeOffset&&(document.getElementById("chatScroll").scrollTop=document.getElementById(e.mensajeOffset.id).offsetTop)}))},enviar:function(){this.scrollToBottom();var e=this.$refs.inputTexto.value;if(""!=e){this.$refs.inputTexto.value="";var s=new FormData;s.append("message",e),s.append("receiver_id",this.$route.params.user_dest_id);var t=this;this.$axios.post(this.$localurl+"/api/v1/messages/textMessage",s).then((function(){t.getChat()})).catch((function(e){401==e.response.status&&(localStorage.removeItem("$expire"),t.$router.push("/login")),alert("Se produjo un error, reintente")}))}},isOverflown:function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth},adjuntar:function(){this.$refs.adjuntoFiles.click()},changeAdjunto:function(){if(this.$refs.adjuntoFiles.files.length>0){var e=new FormData;e.append("message","archivos"),e.append("receiver_id",this.$route.params.user_dest_id),this.$refs.adjuntoFiles.files.forEach((function(s,t){e.append("file["+t+"]",s)}));var s=this;this.$axios.post(this.$localurl+"/api/v1/messages/fileMessage",e).then((function(){s.getChat()})).catch((function(e){401==e.response.status&&(localStorage.removeItem("$expire"),s.$router.push("/login")),alert("Se produjo un error, reintente")}))}}}},u=l,h=(t("fd00"),t("a8a4"),t("2877")),m=Object(h["a"])(u,a,n,!1,null,"5010582f",null);s["default"]=m.exports},a8a4:function(e,s,t){"use strict";var a=t("bc91"),n=t.n(a);n.a},bc91:function(e,s,t){},cc2d:function(e,s,t){},fd00:function(e,s,t){"use strict";var a=t("cc2d"),n=t.n(a);n.a}}]);
//# sourceMappingURL=chat.9f6fcd14.js.map