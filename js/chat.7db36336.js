(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"083e":function(e,t,s){"use strict";var a=s("ae90"),n=s.n(a);n.a},"293a":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"home"},[s("div",{staticClass:"home-body"},[s("div",{staticClass:"home-right"},[s("div",{staticClass:"chat"},[s("div",{ref:"chatScroll",staticClass:"chat-scroll",attrs:{id:"chatScroll"},on:{scroll:e.onScroll}},e._l(e.mensajes,(function(t){return s("div",{key:t.id,staticClass:"chat-container",class:{"chat-mensaje-propio":t.sender_id==e.userId},attrs:{id:t.id}},[s("MensajeTexto",{directives:[{name:"show",rawName:"v-show",value:null!=t.message_type&&"TextMessage"==t.message_type.substr(11,100),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'TextMessage'"}],attrs:{mensaje:t.message}}),s("MensajeArchivo",{directives:[{name:"show",rawName:"v-show",value:null!=t.message_type&&"FileMessage"==t.message_type.substr(11,100)&&e.esArchivo(t),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esArchivo(mensaje)"}],attrs:{mensaje:t.message}}),s("MensajeImagen",{directives:[{name:"show",rawName:"v-show",value:null!=t.message_type&&"FileMessage"==t.message_type.substr(11,100)&&e.esImagen(t),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esImagen(mensaje)"}],attrs:{mensaje:t.message}})],1)})),0),s("div",{staticClass:"chat-bottom"},[s("div",{staticClass:"chat-adjuntar",attrs:{title:"Adjuntar"},on:{click:function(t){return e.adjuntar()}}},[s("input",{ref:"adjuntoFiles",staticClass:"app-hide",attrs:{type:"file",multiple:""},on:{change:function(t){return e.changeAdjunto()}}}),s("svg",{attrs:{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"24",height:"24"}},[s("path",{attrs:{fill:"currentColor",d:"M1.816 15.556v.002c0 1.502.584 2.912 1.646 3.972s2.472 1.647 3.974 1.647a5.58 5.58 0 0 0 3.972-1.645l9.547-9.548c.769-.768 1.147-1.767 1.058-2.817-.079-.968-.548-1.927-1.319-2.698-1.594-1.592-4.068-1.711-5.517-.262l-7.916 7.915c-.881.881-.792 2.25.214 3.261.959.958 2.423 1.053 3.263.215l5.511-5.512c.28-.28.267-.722.053-.936l-.244-.244c-.191-.191-.567-.349-.957.04l-5.506 5.506c-.18.18-.635.127-.976-.214-.098-.097-.576-.613-.213-.973l7.915-7.917c.818-.817 2.267-.699 3.23.262.5.501.802 1.1.849 1.685.051.573-.156 1.111-.589 1.543l-9.547 9.549a3.97 3.97 0 0 1-2.829 1.171 3.975 3.975 0 0 1-2.83-1.173 3.973 3.973 0 0 1-1.172-2.828c0-1.071.415-2.076 1.172-2.83l7.209-7.211c.157-.157.264-.579.028-.814L11.5 4.36a.572.572 0 0 0-.834.018l-7.205 7.207a5.577 5.577 0 0 0-1.645 3.971z"}})])]),s("input",{ref:"inputTexto",attrs:{type:"text",placeholder:"Escribe un mensaje aqu√≠"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.enviar()}}}),s("button",{staticClass:"chat-enviar",on:{click:function(t){return e.enviar()}}},[e._v("Enviar")])])])])])])},n=[],i=(s("99af"),s("4160"),s("45fc"),s("ac1f"),s("1276"),s("159b"),s("b620")),r=s("901b"),o=s("8a60"),c={name:"Chat",components:{MensajeTexto:i["a"],MensajeArchivo:r["a"],MensajeImagen:o["a"]},data:function(){return{mensajes:[],userId:null,primeraPagina:!0,currentPage:0,lastPage:0,mensajeOffset:null}},props:{},computed:{},mounted:function(){this.userId=localStorage.getItem("$userId"),this.getChat(),this.actualizar(),this.mensajes=[],this.$refs.chatScroll.addEventListener("touchmove",this.onScroll)},created:function(){var e=this;this.$eventHub.$on("chat-get",(function(t){return e.getChat(t)}))},methods:{actualizar:function(){var e=this;setTimeout((function(){e.getChat(),e.actualizar()}),3e3)},esImagen:function(e){var t=e.message.files[0].file.split(".")[1];return"png"==t||"jpg"==t||"svg"==t||"jpeg"==t},esArchivo:function(e){return 0==this.esImagen(e)},getChat:function(e){null==e?e=this.$route.params.id:(this.mensajes=[],this.primeraPagina=!0);var t=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+e).then((function(e){1!=t.primeraPagina||t.isOverflown(document.getElementById("chatScroll"))||(t.primeraPagina=!1,t.getChatPage(2));var s=!1;t.lastPage=e.data.messages.last_page,e.data.messages.data.reverse(),e.data.messages.data.forEach((function(e){t.mensajes.some((function(t){return t.id==e.id}))||e.conversation_id!=t.$route.params.id||(t.mensajes.push(e),s=!0)})),1==s&&(t.mensajeOffset=t.mensajes[t.mensajes.length-1],t.scrollToBottom())})).catch((function(e){401==e.response.status&&t.$router.push("/login")}))},getChatPage:function(e){this.mensajeOffset=this.mensajes[0],this.currentPage=e;var t="";null!=e&&(t="?page="+e);var s=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+this.$route.params.id+t).then((function(e){e.data.messages.data.reverse(),s.mensajes=e.data.messages.data.concat(s.mensajes),s.scrollToBottom()})).catch((function(e){401==e.response.status&&s.$router.push("/login")}))},onScroll:function(){var e=this.$refs.chatScroll;e.scrollTop<.1*e.clientHeight&&this.currentPage<this.lastPage&&(this.offset=this.offset+this.limit,this.currentPage++,this.getChatPage(this.currentPage))},scrollToBottom:function(){var e=this;this.$nextTick((function(){document.getElementById("chatScroll").scrollTop=document.getElementById(e.mensajeOffset.id).offsetTop}))},enviar:function(){this.scrollToBottom();var e=this.$refs.inputTexto.value;if(""!=e){this.$refs.inputTexto.value="";var t=new FormData;t.append("message",e),t.append("receiver_id",this.$route.params.user_dest_id);var s=this;this.$axios.post(this.$localurl+"/api/v1/messages/textMessage",t).then((function(){s.getChat()})).catch((function(e){401==e.response.status&&s.$router.push("/login"),alert("Se produjo un error, reintente")}))}},isOverflown:function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth},adjuntar:function(){this.$refs.adjuntoFiles.click()},changeAdjunto:function(){if(this.$refs.adjuntoFiles.files.length>0){var e=new FormData;e.append("message","archivos"),e.append("receiver_id",this.$route.params.user_dest_id),this.$refs.adjuntoFiles.files.forEach((function(t,s){e.append("file["+s+"]",t)}));var t=this;this.$axios.post(this.$localurl+"/api/v1/messages/fileMessage",e).then((function(){t.getChat()})).catch((function(e){401==e.response.status&&t.$router.push("/login"),alert("Se produjo un error, reintente")}))}}}},l=c,u=(s("d2d0"),s("083e"),s("2877")),h=Object(u["a"])(l,a,n,!1,null,"088ff6d3",null);t["default"]=h.exports},ae90:function(e,t,s){},c170:function(e,t,s){},d2d0:function(e,t,s){"use strict";var a=s("c170"),n=s.n(a);n.a}}]);
//# sourceMappingURL=chat.7db36336.js.map