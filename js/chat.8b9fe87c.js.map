{"version":3,"sources":["webpack:///./src/assets/img/back.png","webpack:///./src/views/Chat.vue?4d83","webpack:///src/views/Chat.vue","webpack:///./src/views/Chat.vue?6ed9","webpack:///./src/views/Chat.vue","webpack:///./src/assets/css/views/home.css?80d4","webpack:///./src/assets/css/components/chat.css?37fa"],"names":["module","exports","render","_vm","this","_h","$createElement","_c","_self","staticClass","on","$event","$router","back","attrs","_v","_s","nombreContacto","ref","onScroll","_l","mensaje","key","id","class","sender_id","userId","message","type","indexOf","_k","keyCode","enviar","staticRenderFns","data","mensajes","conversaciones","primeraPagina","currentPage","lastPage","mensajeOffset","seguirActualizando","props","computed","mounted","localStorage","getItem","getChat","actualizar","$refs","chatScroll","addEventListener","created","$eventHub","$on","methods","that","setTimeout","$route","params","$axios","getChatPage","pagina","pag","target","scrollTop","clientHeight","offset","limit","scrollToBottom","$nextTick","document","getElementById","texto","inputTexto","value","FormData","append","user_dest_id","isOverflown","component"],"mappings":"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","file":"js/chat.8b9fe87c.js","sourcesContent":["module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAqCAYAAAD1T9h6AAAABHNCSVQICAgIfAhkiAAAAVlJREFUWEfV2c1Nw0AQQOGXAhCUkBLoAOgESsiFHuggR1JBOHIDUQEUgEQJHDhyiCayI8da/86sd8b3jN+3q0ReZ4XtdQXsgQ3waTs6PW1leBOJfwOugV/gbgmEFaAZX6/JIggLQCpeEF/AbbUbhht9PkoLKBovFA2geLwG4CJ+LsBN/ByAq/ipAHfxUwAu48cC3MaPAbiOHwK4j+8DhIjvAoSJTwFCxbcB4eKbgJDxNaAr/q86Uf1ne5jXD97K4/Q7cKOfVWTCowDkDCuIyyIJupseAXJFRZwANeIDuGgtyhPwqluobJ/+bh8pu3biAXjOlqEYnDoTh0J0HerDIPreSoRADL1WcY8YAvT9xLr4Yo8BuEaMBbhFTAG4REwFuEPMAbhCzAW4QWgALhBaQHGEBaAPIX/0yWEp22UFSCF2wH228mqwJaCJeFkiXm5oDZCZa+An98rX8w+YCmb+NJKbQwAAAABJRU5ErkJggg==\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"home\"},[_c('div',{staticClass:\"home-body\"},[_c('div',{staticClass:\"home-right\"},[_c('div',{staticClass:\"chat\"},[_c('div',{staticClass:\"chat-contacto\",on:{\"click\":function($event){return _vm.$router.back()}}},[_c('img',{attrs:{\"src\":require(\"../assets/img/back.png\")}}),_c('label',[_vm._v(_vm._s(_vm.nombreContacto))])]),_c('div',{ref:\"chatScroll\",staticClass:\"chat-scroll\",attrs:{\"id\":\"chatScroll\"},on:{\"scroll\":_vm.onScroll}},_vm._l((_vm.mensajes),function(mensaje){return _c('div',{key:mensaje.id,staticClass:\"chat-container\",class:{ 'chat-mensaje-propio': mensaje.sender_id == _vm.userId },attrs:{\"id\":mensaje.id}},[_c('div',{staticClass:\"chat-mensaje\"},[_c('label',[_vm._v(_vm._s(mensaje.message))])])])}),0),_c('div',{staticClass:\"chat-bottom\"},[_c('input',{ref:\"inputTexto\",attrs:{\"type\":\"text\",\"placeholder\":\"Escribe un mensaje aquí\"},on:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.enviar()}}}),_c('button',{staticClass:\"chat-enviar\",on:{\"click\":function($event){return _vm.enviar()}}},[_vm._v(\"Enviar\")])])])])])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"home\">\n    <div class=\"home-body\">\n      <div class=\"home-right\">\n        <div class=\"chat\">\n          <div class=\"chat-contacto\" @click=\"$router.back()\">\n            <img src=\"../assets/img/back.png\" />\n            <label>{{nombreContacto}}</label>\n          </div>\n          <div id=\"chatScroll\" class=\"chat-scroll\" ref=\"chatScroll\" @scroll=\"onScroll\">\n            <div\n              v-for=\"mensaje in mensajes\"\n              :key=\"mensaje.id\"\n              :id=\"mensaje.id\"\n              class=\"chat-container\"\n              v-bind:class=\"{ 'chat-mensaje-propio': mensaje.sender_id == userId }\"\n            >\n              <div class=\"chat-mensaje\">\n                <label>{{ mensaje.message }}</label>\n              </div>\n            </div>\n          </div>\n\n          <div class=\"chat-bottom\">\n            <input\n              type=\"text\"\n              placeholder=\"Escribe un mensaje aquí\"\n              ref=\"inputTexto\"\n              v-on:keyup.enter=\"enviar()\"\n            />\n            <button class=\"chat-enviar\" @click=\"enviar()\">Enviar</button>\n          </div>\n        </div>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script>\nexport default {\n  data() {\n    return {\n      mensajes: [],\n      conversaciones: [],\n      userId: null,\n      primeraPagina: true,\n      currentPage: 0,\n      lastPage: 0,\n      mensajeOffset: null,\n      seguirActualizando: true,\n      nombreContacto: \"\"\n    };\n  },\n  props: {},\n  computed: {},\n  mounted() {\n    this.userId = localStorage.getItem(\"$userId\");\n    this.getChat();\n    this.actualizar();\n    this.mensajes = [];\n    this.$refs.chatScroll.addEventListener(\"touchmove\", this.onScroll);\n  },\n  created() {\n    this.$eventHub.$on(\"loged\", () => (this.seguirActualizando = true));\n    this.$eventHub.$on(\"chat-get\", id => this.getChat(id));\n  },\n  methods: {\n    actualizar() {\n      if (this.seguirActualizando) {\n        var that = this;\n        setTimeout(function() {\n          that.getChat();\n          that.actualizar();\n        }, 3000);\n      }\n    },\n    getChat(id) {\n      this.nombreContacto = localStorage.getItem(\"nombreContacto\");\n      if (id == null) {\n        id = this.$route.params.id;\n      } else {\n        this.mensajes = [];\n        this.primeraPagina = true;\n      }\n      var that = this;\n      this.$axios\n        .get(this.$localurl + \"/api/v1/messages/\" + id)\n        .then(function(response) {\n          if (\n            that.primeraPagina == true &&\n            !that.isOverflown(document.getElementById(\"chatScroll\"))\n          ) {\n            that.primeraPagina = false;\n            that.getChatPage(2);\n          }\n          var scrollear = false;\n          that.lastPage = response.data.messages.last_page;\n          response.data.messages.data.reverse();\n          response.data.messages.data.forEach(m => {\n            if (\n              !that.mensajes.some(mensaje => mensaje.id == m.id) &&\n              m.conversation_id == that.$route.params.id\n            ) {\n              that.mensajes.push(m);\n              scrollear = true;\n            }\n          });\n          if (scrollear == true) {\n            that.mensajeOffset = that.mensajes[that.mensajes.length - 1];\n            that.scrollToBottom();\n          }\n        })\n        .catch(function(response) {\n          if (response.response.status == 401) {\n            that.seguirActualizando = false;\n            that.$router.push(\"/login\");\n          }\n        });\n    },\n    getChatPage(pagina) {\n      this.mensajeOffset = this.mensajes[0];\n      this.currentPage = pagina;\n      var pag = \"\";\n      if (pagina != null) {\n        pag = \"?page=\" + pagina;\n      }\n      var that = this;\n      this.$axios\n        .get(this.$localurl + \"/api/v1/messages/\" + this.$route.params.id + pag)\n        .then(function(response) {\n          response.data.messages.data.reverse();\n          that.mensajes = response.data.messages.data.concat(that.mensajes);\n          that.scrollToBottom();\n        })\n        .catch(function(response) {\n          if (response.response.status == 401) {\n            that.seguirActualizando = false;\n            that.$router.push(\"/login\");\n          }\n        });\n    },\n    onScroll() {\n      var target = this.$refs.chatScroll;\n      if (target.scrollTop < target.clientHeight * 0.1) {\n        if (this.currentPage < this.lastPage) {\n          this.offset = this.offset + this.limit;\n          this.currentPage++;\n          this.getChatPage(this.currentPage);\n        }\n      }\n    },\n    scrollToBottom() {\n      var that = this;\n      this.$nextTick(() => {\n        document.getElementById(\n          \"chatScroll\"\n        ).scrollTop = document.getElementById(that.mensajeOffset.id).offsetTop;\n      });\n    },\n    enviar() {\n      this.scrollToBottom();\n      var texto = this.$refs.inputTexto.value;\n      if (texto != \"\") {\n        this.$refs.inputTexto.value = \"\";\n        var data = new FormData();\n        data.append(\"message\", texto);\n        data.append(\"receiver_id\", this.$route.params.user_dest_id);\n        var that = this;\n        this.$axios\n          .post(this.$localurl + \"/api/v1/messages\", data)\n          .then(function() {\n            that.getChat();\n          })\n          .catch(function(response) {\n            if (response.response.status == 401) {\n              that.seguirActualizando = false;\n              that.$router.push(\"/login\");\n            }\n            alert(\"Se produjo un error, reintente\");\n          });\n      }\n    },\n    isOverflown(element) {\n      return (\n        element.scrollHeight > element.clientHeight ||\n        element.scrollWidth > element.clientWidth\n      );\n    }\n  }\n};\n</script>\n\n<style scoped src=\"../assets/css/components/chat.css\"></style>\n<style scoped src=\"../assets/css/views/home.css\"></style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Chat.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./Chat.vue?vue&type=template&id=ca7eaefa&scoped=true&\"\nimport script from \"./Chat.vue?vue&type=script&lang=js&\"\nexport * from \"./Chat.vue?vue&type=script&lang=js&\"\nimport style0 from \"../assets/css/components/chat.css?vue&type=style&index=0&id=ca7eaefa&scoped=true&lang=css&\"\nimport style1 from \"../assets/css/views/home.css?vue&type=style&index=1&id=ca7eaefa&scoped=true&lang=css&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"ca7eaefa\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!./home.css?vue&type=style&index=1&id=ca7eaefa&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!./home.css?vue&type=style&index=1&id=ca7eaefa&scoped=true&lang=css&\"","import mod from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!./chat.css?vue&type=style&index=0&id=ca7eaefa&scoped=true&lang=css&\"; export default mod; export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--6-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--6-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--6-oneOf-1-2!./chat.css?vue&type=style&index=0&id=ca7eaefa&scoped=true&lang=css&\""],"sourceRoot":""}