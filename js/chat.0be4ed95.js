(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chat"],{"01b5":function(e,s,t){"use strict";var a=t("3ec0"),n=t.n(a);n.a},"293a":function(e,s,t){"use strict";t.r(s);var a=function(){var e=this,s=e.$createElement,t=e._self._c||s;return t("div",{staticClass:"home"},[t("div",{staticClass:"home-body"},[t("div",{staticClass:"home-right"},[t("div",{staticClass:"chat"},[t("div",{ref:"chatScroll",staticClass:"chat-scroll",attrs:{id:"chatScroll"},on:{scroll:e.onScroll}},e._l(e.mensajes,(function(s){return t("div",{key:s.id,staticClass:"chat-container",class:{"chat-mensaje-propio":s.sender_id==e.userId},attrs:{id:s.id}},[t("MensajeTexto",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"TextMessage"==s.message_type.substr(11,100),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'TextMessage'"}],attrs:{mensaje:s.message}}),t("MensajeArchivo",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"FileMessage"==s.message_type.substr(11,100)&&e.esArchivo(s),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esArchivo(mensaje)"}],attrs:{mensaje:s.message}}),t("MensajeImagen",{directives:[{name:"show",rawName:"v-show",value:null!=s.message_type&&"FileMessage"==s.message_type.substr(11,100)&&e.esImagen(s),expression:"mensaje.message_type != null && mensaje.message_type.substr(11,100) == 'FileMessage' && esImagen(mensaje)"}],attrs:{mensaje:s.message}})],1)})),0),t("div",{staticClass:"chat-bottom"},[t("input",{ref:"inputTexto",attrs:{type:"text",placeholder:"Escribe un mensaje aqu√≠"},on:{keyup:function(s){return!s.type.indexOf("key")&&e._k(s.keyCode,"enter",13,s.key,"Enter")?null:e.enviar()}}}),t("button",{staticClass:"chat-enviar",on:{click:function(s){return e.enviar()}}},[e._v("Enviar")])])])])])])},n=[],i=(t("99af"),t("4160"),t("45fc"),t("ac1f"),t("1276"),t("159b"),t("b620")),r=t("901b"),o=t("8a60"),c={name:"Chat",components:{MensajeTexto:i["a"],MensajeArchivo:r["a"],MensajeImagen:o["a"]},data:function(){return{mensajes:[],userId:null,primeraPagina:!0,currentPage:0,lastPage:0,mensajeOffset:null}},props:{},computed:{},mounted:function(){this.userId=localStorage.getItem("$userId"),this.getChat(),this.actualizar(),this.mensajes=[],this.$refs.chatScroll.addEventListener("touchmove",this.onScroll)},created:function(){var e=this;this.$eventHub.$on("chat-get",(function(s){return e.getChat(s)}))},methods:{actualizar:function(){var e=this;setTimeout((function(){e.getChat(),e.actualizar()}),3e3)},esImagen:function(e){var s=e.message.files[0].file.split(".")[1];return"png"==s||"jpg"==s||"svg"==s||"jpeg"==s},esArchivo:function(e){return 0==this.esImagen(e)},getChat:function(e){null==e?e=this.$route.params.id:(this.mensajes=[],this.primeraPagina=!0);var s=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+e).then((function(e){1!=s.primeraPagina||s.isOverflown(document.getElementById("chatScroll"))||(s.primeraPagina=!1,s.getChatPage(2));var t=!1;s.lastPage=e.data.messages.last_page,e.data.messages.data.reverse(),e.data.messages.data.forEach((function(e){s.mensajes.some((function(s){return s.id==e.id}))||e.conversation_id!=s.$route.params.id||(s.mensajes.push(e),t=!0)})),1==t&&(s.mensajeOffset=s.mensajes[s.mensajes.length-1],s.scrollToBottom())})).catch((function(e){401==e.response.status&&s.$router.push("/login")}))},getChatPage:function(e){this.mensajeOffset=this.mensajes[0],this.currentPage=e;var s="";null!=e&&(s="?page="+e);var t=this;this.$axios.get(this.$localurl+"/api/v1/messages/"+this.$route.params.id+s).then((function(e){e.data.messages.data.reverse(),t.mensajes=e.data.messages.data.concat(t.mensajes),t.scrollToBottom()})).catch((function(e){401==e.response.status&&t.$router.push("/login")}))},onScroll:function(){var e=this.$refs.chatScroll;e.scrollTop<.1*e.clientHeight&&this.currentPage<this.lastPage&&(this.offset=this.offset+this.limit,this.currentPage++,this.getChatPage(this.currentPage))},scrollToBottom:function(){var e=this;this.$nextTick((function(){document.getElementById("chatScroll").scrollTop=document.getElementById(e.mensajeOffset.id).offsetTop}))},enviar:function(){this.scrollToBottom();var e=this.$refs.inputTexto.value;if(""!=e){this.$refs.inputTexto.value="";var s=new FormData;s.append("message",e),s.append("receiver_id",this.$route.params.user_dest_id);var t=this;this.$axios.post(this.$localurl+"/api/v1/messages",s).then((function(){t.getChat()})).catch((function(e){401==e.response.status&&t.$router.push("/login"),alert("Se produjo un error, reintente")}))}},isOverflown:function(e){return e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth}}},l=c,u=(t("01b5"),t("8656"),t("2877")),h=Object(u["a"])(l,a,n,!1,null,"a44d5bb8",null);s["default"]=h.exports},"3ec0":function(e,s,t){},8656:function(e,s,t){"use strict";var a=t("f5a7"),n=t.n(a);n.a},f5a7:function(e,s,t){}}]);
//# sourceMappingURL=chat.0be4ed95.js.map